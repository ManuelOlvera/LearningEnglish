(function(a,b){if(typeof define==="function"&&define.amd){define(["forcetk"],b)}else{b(a.forcetk)}}(this,function(a){if(typeof a==="undefined"){a={}}a.ClientUI=function(l,k,h,j,g,i){if(typeof l!=="string"){throw new TypeError("loginURL should be of type String")}this.loginURL=l;if(typeof k!=="string"){throw new TypeError("consumerKey should be of type String")}this.consumerKey=k;if(typeof h!=="string"){throw new TypeError("callbackURL should be of type String")}this.callbackURL=h;if(typeof g!=="function"){throw new TypeError("successCallback should be of type Function")}this.successCallback=g;if(typeof i!=="undefined"&&typeof i!=="function"){throw new TypeError("errorCallback should be of type Function")}this.errorCallback=i;this.client=new a.Client(k,l,j)};a.ClientUI.prototype={login:function e(){console.log("login");var g=localStorage.getItem("ftkui_refresh_token_learningEnglish");console.log("refreshToken",g);if(g){var i=this;this.client.setRefreshToken(g);this.client.refreshAccessToken(function j(k){if(i.successCallback){i.client.setSessionToken(k.access_token,null,k.instance_url);i.successCallback.call(i,i.client)}else{console.log("INFO: OAuth login successful!")}},function h(k,m,l){i._authenticate.call(i)})}else{this._authenticate()}},logout:function c(g){var j=this,h=encodeURIComponent(this.client.refreshToken),i=function(){$.ajax({type:"GET",async:j.client.asyncAjax,url:j.client.instanceUrl+"/secur/logout.jsp",cache:false,processData:false,success:function(l,m,k){if(g){g.call()}},error:function(k,m,l){console.log("logout error");if(g){g.call()}}})};localStorage.setItem("ftkui_refresh_token_learningEnglish",null);$.ajax({type:"POST",url:j.client.instanceUrl+"/services/oauth2/revoke",cache:false,processData:false,data:"token="+h,success:function(l,m,k){i()},error:function(k,m,l){i()}})},_authenticate:function d(){var m=this;console.log("window",window);console.log("window.device",window.device);if(typeof window.device==="undefined"){var h=524,g=674,l=window.screenY+(window.outerHeight/2-h/2),n=window.screenX+(window.outerWidth/2-g/2);var k=window.open(this._getAuthorizeUrl(),"Login to Salesforce","height="+h+",width="+g+",toolbar=1,scrollbars=1,status=1,resizable=1,location=0,menuBar=0,left="+n+",top="+l,true);if(k){var j=setInterval(function(){if(k.closed){clearInterval(j)}else{var o=k.location.href;if(typeof o!=="undefined"&&o.indexOf(m.callbackURL)==0){k.close();m._sessionCallback(o)}}},250);k.focus()}}else{if(window.plugins&&window.plugins.childBrowser){var i=window.plugins.childBrowser;i.onLocationChange=function(o){if(o.indexOf(m.callbackURL)==0){console.log();i.close();o=decodeURI(o).replace("%23","#");m._sessionCallback(o)}};i.showWebPage(this._getAuthorizeUrl(),{showLocationBar:true,locationBarAlign:"bottom"})}else{alert("ERROR");throw new Error("Didn't find way to authenticate!")}}},_getAuthorizeUrl:function b(){return this.loginURL+"services/oauth2/authorize?&response_type=token&client_id="+encodeURIComponent(this.consumerKey)+"&redirect_uri="+encodeURIComponent(this.callbackURL)},_sessionCallback:function f(k){var g={},i=k.split("#")[1];if(i){var l=i.split("&");for(var h in l){var j=l[h].split("=");g[j[0]]=decodeURIComponent(j[1])}}if(typeof g.access_token==="undefined"){if(this.errorCallback){this.errorCallback({code:0,message:"Unauthorized - no OAuth response!"})}else{console.log("ERROR: No OAuth response!")}}else{localStorage.setItem("ftkui_refresh_token_learningEnglish",g.refresh_token);this.client.setRefreshToken(g.refresh_token);this.client.setSessionToken(g.access_token,null,g.instance_url);if(this.successCallback){this.successCallback(this.client)}else{console.log("INFO: OAuth login successful!")}}}};return a}));